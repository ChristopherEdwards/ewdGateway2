exports.start = function(mumps) {

  mumps.changeHandler.on('aftersave', function(node) {
    console.log('***!!!! ' + process.pid + ' - saved ' + node.global + ' ' + JSON.stringify(node.subscripts) + ': ' + node.data);

   // Tony Shannon's Globals:

     //  CLPPats(id, 'lastName') = 'Smith'
     //    creates CLPPatIndex('lastName', 'smith', id) = 'Smith'

    if (node.global === 'CLPPats') {
      if (node.subscripts[1] === 'lastName') {
        var index = new mumps.Global('CLPPatIndex');
        var dataRecord = new mumps.GlobalNode(node.global, node.subscripts);
        var id = node.subscripts[0];
        var oldName = dataRecord._value.toLowerCase();
        if (oldName !== '') {
          index.$('lastName').$(oldName).$(id)._delete();
        }
        index.$('lastName').$(node.data.toLowerCase()).$(id)._value = node.data;
      }
    }
  });
  

};